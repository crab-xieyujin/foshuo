-- ==========================================
-- 佛说 (Foshuo) 数据库初始化脚本
-- 功能：创建核心经文表、设置安全策略、预灌入种子数据
-- 注意：采用 PostgreSQL 的 Dollar Quoting ($$) 语法支持特殊字符
-- ==========================================

-- 1. 创建『经文库』表 (scriptures)
-- 该表存储所有可供阅读的经文、咒语及开示内容
create table if not exists public.scriptures (
  -- 唯一标识符 
  id text not null primary key, 
  
  -- 经文标题 (例如: '般若波罗蜜多心经')
  title text not null,
  
  -- 译者/作者 (例如: '唐三藏法师玄奘 译')
  author text,
  
  -- 经文简介 (供列表页展示)
  description text,
  
  -- 字数统计 (例如: '260字')
  size text,
  
  -- 封面图片路径
  cover_image text,
  
  -- 朗诵音频路径
  audio_url text,
  
  -- 背景音乐路径
  bgm_url text,
  
  -- 完整正文内容
  content text not null,
  
  -- 分页后的文本数组
  pages text[],
  
  -- 创建时间
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- ==========================================
-- 2. 安全策略 (RLS)
-- ==========================================

alter table public.scriptures enable row level security;

-- 权限 A：允许所有人读取经文内容
do $$ 
begin
  if not exists (select 1 from pg_policies where policyname = '允许匿名读取经文') then
    create policy "允许匿名读取经文" on public.scriptures for select using (true);
  end if;
end $$;

-- 权限 B：仅允许通过认证的管理员修改记录
do $$ 
begin
  if not exists (select 1 from pg_policies where policyname = '允许管理员增删改') then
    create policy "允许管理员增删改" on public.scriptures for all using (auth.role() = 'authenticated');
  end if;
end $$;


-- ==========================================
-- 3. 种子数据 (SEED DATA)
-- 使用 $$ 标记长文本，避免引号报错
-- ==========================================

-- 清理旧的种子数据（可选，根据需求保留）
-- delete from public.scriptures;

INSERT INTO public.scriptures (id, title, author, description, size, audio_url, content)
VALUES
(
  '大悲咒',
  '大悲咒',
  '伽梵达摩所译',
  '千手千眼观世音菩萨广大圆满无碍大悲心陀罗尼。南无喝啰怛那哆啰夜耶...',
  '524字',
  '/assets/audio/heart-sutra.mp3',
  $$千手千眼观世音菩萨广大圆满无碍大悲心陀罗尼
南无喝啰怛那哆啰夜耶。南无阿唎耶。婆卢羯帝烁钵啰耶。
菩提萨埵婆耶。摩诃萨埵婆耶。
摩诃迦卢尼迦耶。唵。萨皤啰罚曳。数怛那怛写。
南无悉吉栗埵伊蒙阿唎耶。婆卢吉帝室佛啰楞驮婆。
南无那啰谨墀。醯唎摩诃皤哆沙咩。萨婆阿他豆输朋。
阿逝孕。萨婆萨哆那摩婆萨多。
那摩婆伽。摩罚特豆。怛姪他。唵。阿婆卢醯。卢迦帝。迦罗帝。
夷醯唎。摩诃菩提萨埵。萨婆萨婆。
摩啰摩啰。摩醯摩醯唎驮孕。
俱卢俱卢羯蒙。度卢度卢罚阇耶帝。摩诃罚阇耶帝。
陀啰陀啰。地唎尼。室佛啰耶。遮啰遮啰。
摩摩罚摩啰。穆帝隶。伊醯伊醯。室那室那。阿啰参佛啰舍利。
罚沙罚参。佛啰舍耶。呼卢呼卢摩啰。
呼卢呼卢醯利。娑啰娑啰。悉唎悉唎。苏嚧。苏嚧。
菩提夜菩提夜。菩驮夜菩驮夜。弥帝唎夜。那啰谨墀。地唎瑟尼那。
婆夜摩那。娑婆诃。
悉陀夜。娑婆诃。摩诃悉陀夜。娑婆诃。
悉陀喻艺。室皤啰耶。娑婆诃。那啰谨墀。娑婆诃。
摩啰那啰。娑婆诃。悉啰僧阿穆佉耶。娑婆诃。
娑婆摩诃阿悉陀夜。娑婆诃。者吉啰阿悉陀夜。
娑婆诃。波陀摩羯悉陀夜。娑婆诃。那啰谨墀皤伽啰耶。
娑婆诃。摩婆利胜羯啰夜。娑婆诃。
南无喝啰怛那哆啰夜耶。南无阿唎耶。婆嚧吉帝。烁皤啰夜。
娑婆诃。唵。悉殿都。漫多啰。跋陀耶。娑婆诃。$$
),
(
  '般若波罗蜜多心经',
  '般若波罗蜜多心经',
  '唐三藏法师玄奘 译',
  '观自在菩萨，行深般若波罗蜜多时，照见五蕴皆空，度一切苦厄。 舍利子，色不异空...',
  '312字',
  '/assets/audio/heart-sutra.mp3',
  $$观自在菩萨，行深般若波罗蜜多时，照见五蕴皆空，度一切苦厄。
舍利子，色不异空，空不异色，色即是空，空即是色，受想行识，亦复如是。
舍利子，是诸法空相，不生不灭，不垢不净，不增不减。
是故空中无色，无受想行识，无眼耳鼻舌意，无色声香味触法，无眼界，乃至无意识界。
无无明，亦无无明尽，乃至无老死，亦无老死尽。
无苦集灭道，无智亦无得。
以无所得故，菩提萨埵，依般若波罗蜜多故，心无挂碍。
无挂碍故，无有恐怖，远离颠倒梦想，究竟涅槃。
三世诸佛，依般若波罗蜜多故，得阿耨多罗三藐三菩提。
故知般若波罗蜜多，是大神咒，是大明咒，是无上咒，是无等等咒，能除一切苦，真实不虚。
故说般若波罗蜜多咒，即说咒曰：
揭谛揭谛，波罗揭谛，波罗僧揭谛，菩提萨婆诃。$$
),
(
  '诸佛实相开示',
  '诸佛实相开示',
  '无',
  '南无本师释迦牟尼佛·南无本师释迦牟尼佛·南无本师释迦牟尼佛。无上甚深微妙法·百千万劫难遭遇...',
  '321字',
  '/assets/audio/heart-sutra.mp3',
  $$南无本师释迦牟尼佛·南无本师释迦牟尼佛·南无本师释迦牟尼佛
无上甚深微妙法·百千万劫难遭遇
我今见闻得受持·愿解如来真实义
念一心皈命阿弥陀佛福慧圆满
佛教是佛陀对一切众生
说明事实的真相
令众生破迷开悟·离苦得乐
善因善果·恶因恶果
念阿弥陀佛是因·成阿弥陀佛是果；
做人要老实·谦卑·低调·包容；
不可自私自利·不可有自己的意思；
从我做起·从身口意做起；
一生信愿持名·老实念佛·求生极乐；
一心皈命阿弥陀佛·一心皈命阿弥陀佛；
一心皈命阿弥陀佛；
弟子众等

无理由一心皈命阿弥陀佛；
无理由护持一心皈命阿弥陀佛；
无理由落实《诸佛实相开示》；
无理由跟紧阿弥陀佛直到成佛；
同心同德同愿同成佛；
愿虚空法界一切众生破迷开悟·离苦得乐；
一心皈命阿弥陀佛·直通极乐·是极乐人$$
),
(
  '弥陀接引站守则',
  '弥陀接引站守则',
  '无',
  '遵纪守法，利国利民，深信因果，反省自己；国泰民安，家庭和睦，社会和谐，各得其所...',
  '120字',
  '/assets/audio/heart-sutra.mp3',
  $$遵纪守法，利国利民，深信因果，反省自己；
国泰民安，家庭和睦，社会和谐，各得其所；
面对一切，接受一切，努力随缘，随缘努力；
法门众多，随喜赞叹，互相尊重，互相包容；
从我做起，没事没事，心身清净，安详自在；
一心皈命阿弥陀佛，读诵诸佛实相开示；
一心皈命阿弥陀佛 落实诸佛实相开示；
一心皈命阿弥陀佛 直通极乐是极乐人；
一心皈命阿弥陀佛 绝对往生极乐世界$$
),
(
  '弟子修学自我反省',
  '弟子修学自我反省',
  '弥陀接引站',
  '弟子修学自我反省。弥陀接引站。无理由至诚恭敬；无理由谨遵佛陀教诫；专信奉行·不忘初心...',
  '240字',
  '/assets/audio/heart-sutra.mp3',
  $$弟子修学自我反省
弥陀接引站
无理由至诚恭敬；
无理由谨遵佛陀教诫；
专信奉行·不忘初心；
切不可随顺烦恼习气；
切不可有贪图回报·恭敬·供养·赞叹之心；
切不可有计较·攀比·妒忌·嗔恨之心；
须正直无私·不计得失·去除习气；
个人事小·成佛事大·法身慧命事大；
无理由同心同德同愿同成佛；
无理由恭敬谛听佛陀法音教诲；
无理由落实《诸佛实相开示》及《发愿文》；
以行践愿·以愿促行·贵在保持·贵在一心；
无理由老实听话真干·一生只干一回事；
无理由一心皈命阿弥陀佛·直通极乐·是极乐人；
如是精进奉行·方能复元自性清净平等觉；
方不负诸佛如来的苦心教诲·方是真极乐人也；
一心皈命阿弥陀佛，顶礼感恩阿弥陀佛$$
),
(
  '白衣大士神咒',
  '白衣大士神咒',
  '无',
  '南无大慈大悲救苦救难广大灵感观世音菩萨摩诃萨(三称三拜)。南无佛，南无法，南无僧...',
  '115字',
  '/assets/audio/heart-sutra.mp3',
  $$南无大慈大悲救苦救难广大灵感观世音菩萨摩诃萨(三称三拜)
南无佛，南无法，南无僧，
南无救苦救难观世音菩萨。
怛垤哆，唵。伽啰伐哆，伽啰伐哆；
伽诃伐哆；啰伽伐哆，啰伽伐哆，娑婆诃。
天罗神，地罗神，人离难，
难离身，一切灾殃化为尘。
南无摩诃般若波罗蜜。$$
),
(
  '文殊师利发愿经',
  '文殊师利发愿经',
  '天竺三藏法师‌佛陀跋陀罗‌译',
  '身口意清净，除灭诸垢秽 一心恭敬礼，十方三世佛 普贤愿力故，悉睹见诸佛...',
  '980字',
  '/assets/audio/heart-sutra.mp3',
  $$身口意清净，除灭诸垢秽
一心恭敬礼，十方三世佛
普贤愿力故，悉睹见诸佛
一一如来所，一切刹尘礼
于一微尘中，见一切诸佛
菩萨众围绕，法界尘亦然
以众妙音声，宣扬诸最胜
无量功德海，不可得穷尽
以普贤行力，无上众供具
供养于十方，三世一切佛
以妙香华鬘，种种诸伎乐
一切妙庄严，普供养诸佛
我以贪恚痴，造一切恶行
身口意不善，悔过悉除灭
一切众生福，诸声闻缘觉
菩萨及诸佛，功德悉随喜
十方一切佛，初成等正觉
我令悉劝请，转无上法轮
示现涅槃者，合掌恭敬请
住一切尘劫，安乐诸群生
我所集功德，回向施众生
究竟菩萨行，逮无上菩提
悉供养过去，现在十方佛
愿未来世尊，速成菩提道
普庄严十方，一切诸佛刹
如来坐道场，菩萨众充满
令十方众生，除灭诸烦恼
深解真实义，常得安乐住
我修菩萨行，成就宿命智
除灭一切障，永尽无有余
悉远离生死，诸魔烦恼业
犹日处虚空，莲花不著水
遍行游十方，教化诸群生
除灭恶道苦，具足菩萨行
虽随顺世间，不舍菩萨道
尽未来际劫，具修普贤行
若有同行者，愿常集一处
身口意善业，皆悉令同等
若遇善知识，开示普贤行
于此菩萨所，亲近常不离
常见一切佛，菩萨众围绕
尽未来际劫，悉恭敬供养
守护诸佛法，赞叹菩萨行
尽未来劫修，究竟普贤道
虽在生死中，具无尽功德
智慧巧方便，诸三昧解脱
一一微尘中，见不思议刹
于一一刹中，见不思议佛
见如是十方，一切世界海
一一世界海，悉见诸佛海
于一言音中，具一切妙音
一一妙音中，具足最胜音
甚深智慧力，入无尽妙音
转三世诸佛，清净正法轮
一切未来劫，悉能作一念
三世一切劫，悉为一念际
一念中悉见，三世诸如来
亦普分别知，解脱及境界
于一微尘中，出三世净刹
一切十方尘，庄严刹亦然
悉见未来佛，成道转法轮
究竟佛事已，示现入涅槃
神力遍游行，大乘力普门
慈力覆一切，行力功德满
功德力清净，智慧力无碍
三昧方便力，逮得菩提力
清净善业力，除灭烦恼力
坏散诸魔力，具普贤行力
严净佛刹海，度脱众生海
分别诸业海，穷尽智慧海
清净诸行海，满足诸愿海
悉见诸佛海，我于劫海行
三世诸佛行，及无量大愿
我皆悉具足，普贤行成佛
普贤菩萨名，诸佛第一子
我善根回向，愿悉与彼同
身口意清净，自在庄严刹
逮成等正觉，皆悉同普贤
如文殊师利，普贤菩萨行
我所有善根，回向亦如是
三世诸如来，所叹回向道
我回向善根，成满普贤行
愿我命终时，除灭诸障碍
面见阿弥陀，往生安乐国
生彼佛国已，成满诸大愿
阿弥陀如来，现前授我记
严净普贤行，满足文殊愿
尽未来际劫，究竟菩萨行$$
),
(
  '妙法莲华经-观世音菩萨普门品',
  '妙法莲华经-观世音菩萨普门品',
  '姚秦三藏法师鸠摩罗什译',
  '尔时无尽意菩萨即从座起，偏袒右肩，合掌向佛而作是言："世尊，观世音菩萨以何因缘名观世音？" 佛告无尽意菩萨...',
  '2427字',
  '/assets/audio/heart-sutra.mp3',
  $$尔时无尽意菩萨即从座起，偏袒右肩，合掌向佛而作是言："世尊，观世音菩萨以何因缘名观世音？"
佛告无尽意菩萨："善男子，若有无量百千万亿众生，受诸苦恼，闻是观世音菩萨，一心称名，观世音菩萨即时观其音声皆得解脱。若有持是观世音菩萨名者，设入大火，火不能烧，由是菩萨威神力故；若为大水所漂，称其名号，即得浅处；若有百千万亿众生，为求金、银、琉璃、砗磲、玛瑙、珊瑚、琥珀真珠等宝，入于大海，假使黑风吹其船舫，漂坠罗刹鬼国，其中若有乃至一人称观世音菩萨名者，是诸人等皆得解脱罗刹之难。以是因缘，名观世音。若复有人临当被害，称观世音菩萨名号者，彼所执刀杖，寻段段坏，而得解脱。若三千大千国土，满中夜叉、罗刹，欲来恼人，闻其称观世音菩萨名者，是诸恶鬼尚不能以恶眼视之，况复加害；设复有人，若有罪、若无罪，扭械枷锁检系其身，称观世音菩萨名者，皆悉断坏，即得解脱；若三千大千国土，满中怨贼，有一商主将诸商人，赍持重宝，经过险路，其中一人作是唱言，诸善男子，勿得恐怖，汝等应当一心称观世音菩萨名号，是菩萨能以无畏施于众生，汝等若称名者，于此怨贼，当得解脱。众商人闻具发声言，南无观世音菩萨。称其名故，即得解脱。无尽意，观世音菩萨摩诃萨威神之力，巍巍如是。若有众生多于淫欲，常念恭敬观世音菩萨，便得离欲；若多嗔恚，常念恭敬观世音菩萨，便得离嗔；若多愚痴，常念恭敬观世音菩萨，便得离痴。无尽意，观世音菩萨有如是等大威神力，多所饶益，是故众生常应心念。若有女人，设欲求男，礼拜供养观世音菩萨，便生福德智慧之男；设欲求女，便生端正有相之女，宿植德本，众人爱敬。无尽意，观世音菩萨有如是力。若有众生恭敬礼拜观世音菩萨，福不唐捐。是故众生皆应受持观世音菩萨名号。无尽意，若有人受持六十二亿恒河沙菩萨名字，复尽形供养饮食衣服卧具医药，于汝意云何？是善男子、善女人功德多不？"
无尽意言："甚多世尊。"
佛言："若复有人受持观世音菩萨名号，乃至一时礼拜供养，是二人福，正等无异，于百千万亿劫不可穷尽。无尽意，受持观世音菩萨名号，得如是无边福德之利。"
无尽意菩萨白佛言："世尊，观世音菩萨云何游此娑婆世界"云何而为众生说法？方便之力，其事云何？"
佛告无尽意菩萨："善男子，若有国土众生，应以佛身得度者，观世音菩萨即现佛身而为说法，应以辟支佛身得度者，即现辟支佛身而为说法；应以声闻身得度者，即现声闻身而为说法；应以梵王身得度者，即现梵王身而为说法；应以帝释身得度者，即现帝释身而为说法；应以自在天身得度者，即现自在天身而为说法；应以大自在天身得度者，即现大自在天身而为说法；应以天大将军身得度者，即现天大将军身而为说法；应以毗沙门身得度者，即现毗沙门身而为说法；应以小王身得度者，即现小王身而为说法；应以长者身得度者，即现长者身而为说法；应以居士身得度者，即现居士身而为说法；应以宰官身得度者，即现宰官身而为说法；应以婆罗门身得度者，即现婆罗门身而为说法；应以比丘、比丘尼、优婆塞、优婆夷身得度者，即现比丘、比丘尼、优婆塞、优婆夷身而为说法；应以长者居士、宰官、婆罗门妇女身得度者，即现妇女身而为说法；应以童男童女身得度者，即现童男童女身而为说法；应以天、龙、夜叉、乾闼婆、阿修罗、迦楼罗、紧那罗、摩喉罗伽、人、非人等身得度者，即现之而为说法。应以执金刚神得度者，即现执金刚神而为说法；无尽意，是观世音菩萨成就如是功德，以种种形游诸国土，度脱众生，是故汝等应当一心供养观世音菩萨。是观世音菩萨摩诃萨，于怖畏急难之中，能施无畏，是故此娑婆世界，皆号之为施无畏者。"
无尽意菩萨白佛言："世尊，我今当供养观世音菩萨。"即解颈众宝珠璎珞，价值百千两金，而以予之。
作是言："仁者受此法施珍宝璎珞。"
时观世音菩萨不肯受之。无尽意复白观世音菩萨言："仁者愍我等故，受此璎珞。"尔时佛告观世音菩萨："当愍此无尽意菩萨及四众、天、龙、夜叉、乾闼婆、阿修罗、迦楼罗、紧那罗、摩喉罗伽、人、非人等故，受是璎珞。"即时观世音菩萨愍诸四众，及于天、龙、人、非人等，受其璎珞，分作二分，一分奉释迦牟尼佛，一分奉多宝佛塔。"无尽意。观世音菩萨有如是自在神力，游于娑婆世界。"
尔时无尽意菩萨以偈问曰：
"世尊妙相具，我今重问彼，
佛子何因缘，名为观世音？"
具足妙相尊，偈答无尽意。
"汝听观音行，善应诸方所，
弘誓深如海，历劫不思议，
侍多千亿佛，发大清敬愿。
我为汝略说，闻名及见身，
心念不空过，能灭诸有苦。
假使兴害意，推落大火坑，
念彼观音力，火坑变成池。
或漂流巨海，龙鱼诸鬼难，
念彼观音力，波浪不能没。
或在须弥峰，为人所推坠，
念彼观音力，如日虚空住。
或被恶人逐，坠落金刚山，
念彼观音力，不能损一毛。
或值怨贼绕，各执刀加害，
念彼观音力，咸即起慈心。"
或遭王难苦，临刑欲寿终，
念彼观音力，刀寻段段坏。
或囚禁枷锁，手足被扭械，
念彼观音力，释然得解脱。
咒诅诸毒药，所欲害身者，
念彼观音力，还著于本人。
或遇恶罗刹，毒龙诸鬼等，
念彼观音力，时悉不敢害。
若恶兽围绕，利牙爪可怖，
念彼观音力，疾走无边方。
螈蛇及蝮蝎，气毒烟火然，
念彼观音力，寻声自回去。
云雷鼓掣电，降雹澍大雨，
念彼观音力，应时得消散。
众生被困厄，无量苦逼身，
观音妙智力，能救世间苦。
具足神通力，广修智方便，
十方诸国土，无刹不现身。
种种诸恶趣，地狱鬼畜生，
生老病死苦，以渐悉令灭。
真观清净观，广大智慧观，
悲观及慈观，常愿常瞻仰。
无垢清净光，慧日破诸暗，
能伏灾风火，普明照世间。
悲体戒雷震，慈意妙大云，
澍甘露法雨，灭除烦恼焰。
诤讼经官处，怖畏军阵中，
念彼观音力，众怨悉退散。
妙音观世音，梵音海潮音，
胜彼世间音，是故须常念。
念念勿生疑，观世音净圣，
于苦恼死厄，能为作衣怙。
具一切功德，慈眼视众生，
福聚海无量，是故应顶礼。"
尔时持地菩萨即从座起，前白佛言："世尊，若有众生闻是观世音菩萨品自在之业，普门示现神通力者，当知是人功德不少。"佛说是普门品时，众中八万四千众生皆发无等等阿耨多罗三藐三菩提心。$$
);
